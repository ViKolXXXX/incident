{% extends "base.html" %}{% load static %}{% load filters %}

{% block title %}Журнал{% endblock title %}
{% block name_page %}<i class="far fa-book"></i>&nbsp;Журнал{% endblock name_page %}
{% block breadcrumbs %}
    <li><a class="current" href={% url 'journal' %}>События</a></li>
{% endblock breadcrumbs %}
{% block content %}
    <div class="row d-flex justify-content-center my-4" style="height:700px;overflow-y:auto;">
        <div class="col-12">
            <a class="m-2 btn btn-sm btn-secondary" href={% url "event" %}>
                <img alt="#" height="16" src="{% static "vendor/color_icons/db_add_8760.ico" %}"/>&nbsp;Добавить событие
            </a>
            <table id="id_table_event" class="table table-striped table-bordered compact-table" style="width:100%">
                <thead>
                <tr>
                    <th class="size-col-th-1">Регистрационный номер</th>
                    <th class="size-col-th-2">Статус</th>
                    <th class="size-col-th-3">Дата регистрации</th>
                    <th class="size-col-th-4">Суть информации</th>
                    <th class="size-col-th-5">Кл.признак(по статье УК)</th>
                    <th class="size-col-th-6">Кл.признак(угроза)</th>
                    <th class="size-col-th-7">Регион</th>
                    <th class="size-col-th-8">Подразделение</th>
                    <th class="size-col-th-9">Действие</th>
                </tr>
                </thead>
                <tbody>
                {% for event  in events %}
                    <tr>
                        <td class="size-col-td-1" onclick="show_event({{ event.id }})" style="cursor: pointer"><a href="#" style="color: #0b1283">{{ event.reg_number }}</a></td>
                        <td class="size-col-td-2">
                            <div class="status_{{ event.status.id }}">{{ event.status }}</div>
                        </td>
                        <td class="size-col-td-3">{{ event.date_registratsii|date:"d.m.Y" }}</td>
                        <td class="size-col-td-4" >{{ event.sut_info }}</td>
                        <td class="size-col-td-5">{{ event.klassif_priznak_UK.name }}</td>
                        <td class="size-col-td-6">{{ event.klassif_priznak_ugroza.name }}</td>
                        <td class="size-col-td-7">{{ event.region }}</td>
                        <td class="size-col-td-8">{{ event.subdivision.name }}</td>
                        <td class="size-col-td-9">
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <a type="button" class="btn btn-secondary" title="Редактировать" href="{% url "change_event" %}?event_id={{ event.id }}"> <i class="far fa-edit"></i></a>
                                {% if request.user|has_group:"Админ" %}
                                    <a type="button" class="btn btn-sm  btn-secondary" title="Удалить" href="#" onclick="delete_event({{ event.id }},'{{ event.date_registratsii }}')"><i class="far fa-1x fa-trash-alt"></i></a>
                                {% else %}

                                {% endif %}
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    <!--Модальное окно события -->
    <div class="modal fade bd-example-modal-xl" tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel" aria-hidden="true" id="id_modal_event">
        <div class="modal-dialog modal-xl">
            <div class="modal-content" id="id_modal_content">

            </div>
        </div>
    </div>
    <!--Модальное окно удаления -->
    <div class="modal fade" id="id_modal_del" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5>Вы точно хотите удалить запись?</h5>
                </div>
                <div class="modal-body" id="id_body_del">

                </div>
                <div class="modal-footer" id="id_footer_del">
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
{% block js %}
    <script>
        $(document).ready(function () {
            $('#id_table_event').DataTable(
                {
                    "pageLength": 5,
                    "lengthChange": false,
                    "language": {
                        "url": "{% static "vendor/data_tables/ru.json" %}"
                    }
                }
            );
        });

        function show_event(event_id) {
            var params = {
                "event_id": event_id
            };
            $.get("{% url "show_event" %}", params, function (data) {
                $('#id_modal_event').modal('toggle');
                $('#id_modal_content').empty().append(data);

            })
        }

        function delete_event(event_id, event_date) {
            $('#id_modal_del').modal('toggle');
            $('#id_body_del').empty().append(event_date);
            $('#id_footer_del').empty().append("<a type=\"button\" class=\"btn btn-sm  btn-secondary\" title=\"Удалить\" href=\"{% url "delete_event" %}?event_id=" + event_id + "\"><i class=\"far fa-1x fa-trash-alt\"></i> ДА</a>");
        }
    </script>
{% endblock js %}