{% extends "base.html" %}{% load static %}
{% block title %}Журнал{% endblock title %}
{% block name_page %}<i class="far fa-book"></i>&nbsp;Журнал{% endblock name_page %}
{% block breadcrumbs %}
    <li><a class="current" href={% url 'journal' %}>События</a></li>
{% endblock breadcrumbs %}
{% block content %}
    <div class="row d-flex justify-content-center my-4" style="height:700px;overflow-y:auto;">
        <div class="col-12">
            <table id="id_table_event" class="table table-striped table-bordered compact-table" style="width:100%">
                <thead>
                <tr>
                    <th>Тип обращения</th>
                    <th>Статус</th>
                    <th>Дата регистрации</th>
                    <th>Кл.признак(по статье УК)</th>
                    <th>Кл.признак(угроза)</th>
                    <th>Дата окончания</th>
                    <th>Исполнитель(орган)</th>
                    <th>Установлены лица</th>
                    <th>Подразделение</th>
                    <th>Действие</th>
                </tr>
                </thead>
                <tbody>
                {% for event  in events %}
                    <tr>
                        <td onclick="show_event({{ event.id }})" style="cursor: pointer">{{ event.type_message }}</td>
                        <td>{{ event.status }}</td>
                        <td>{{ event.date_registratsii }}</td>
                        <td>{{ event.klassif_priznak_UK.name }}</td>
                        <td>{{ event.klassif_priznak_ugroza.name }}</td>
                        <td>{{ event.date_finish }}</td>
                        <td>{{ event.ispolnitel_organ }}</td>
                        <td>{{ event.identified_face }}</td>
                        <td>{{ event.subdivision.name }}</td>
                        <td>
                            <div class="btn-group" role="group" aria-label="Basic example">
                                <a type="button" class="btn btn-secondary" title="Редактировать"
                                   href="{% url "change_event" %}?event_id={{ event.id }}"> <i class="far fa-edit"></i>
                                </a> <a type="button" class="btn btn-secondary" title="Удалить"
                                        href="{% url "delete_event" %}?event_id={{ event.id }}"><i
                                    class="far fa-1x fa-trash-alt"></i></a>
                            </div>
                        </td>
                    </tr>
                {% endfor %}
            </table>
        </div>
    </div>


    <div class="modal fade " tabindex="-1" role="dialog" aria-labelledby="myExtraLargeModalLabel"
         aria-hidden="true" id="myModal">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLongTitle">Modal title</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
{% endblock content %}
{% block js %}
    <script>
        $(document).ready(function () {
            $('#id_table_event').DataTable(
                {
                    "pageLength": 5,
                    "lengthChange": false,
                    "language": {
                        "url": "{% static "vendor/data_tables/ru.json" %}"
                    }
                }
            );
        });

        function show_event(event_id) {
            var params = {
                "event_id": event_id
            };
            $.get("{% url "show_event" %}", params, function (data) {
                $('#myModal').modal('toggle');
                $('.modal-body').empty();
                $('.modal-body').append(data);

            })
        }
    </script>
{% endblock js %}